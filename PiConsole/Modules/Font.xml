<?xml version="1.0" encoding="utf-8" ?>

<scope
	xmlns="http://metalx.org/Program"
	xmlns:cpu="http://metalx.org/Arm/Arm7/Operators">

	<!--Font.DrawColor(R0 = Character, R1 = Color)-->
	<label id="DrawCharacter" export="Font.DrawCharacter">
		<!--Save Return Address-->
		<cpu:BlockMemory Registers="0100000000000000" ReadFromMemory="false" AddressRegister="13" UpdateAddressRegister="true" AddOffset="false" ApplyOffsetBeforeTransfer="true"/>

		<!--R1 = Character Address-->
		<cpu:ImmediateData Operation="CopyOperand" Operand="0" Destination="1"/>

		<addressOf ref="characterAddresses" type="Absolute8"/>
		<cpu:Immediate8 Operation="OrRegisterWithOperand" Register="1" Rotate="0" Destination="1"/>

		<addressOf ref="characterAddresses" type="Absolute16High8"/>
		<cpu:Immediate8 Operation="OrRegisterWithOperand" Register="1" Rotate="12" Destination="1"/>

		<addressOf ref="characterAddresses" type="Absolute24High8"/>
		<cpu:Immediate8 Operation="OrRegisterWithOperand" Register="1" Rotate="8" Destination="1"/>

		<addressOf ref="characterAddresses" type="Absolute32High8"/>
		<cpu:Immediate8 Operation="OrRegisterWithOperand" Register="1" Rotate="4" Destination="1"/>

		<cpu:RegisterData Operation="AddRegisterAndOperand" Register="0" Operand="1" Destination="1"/>
		<cpu:RegisterData Operation="AddRegisterAndOperand" Register="0" Operand="1" Destination="1"/>
		<cpu:RegisterData Operation="AddRegisterAndOperand" Register="0" Operand="1" Destination="1"/>
		<cpu:RegisterData Operation="AddRegisterAndOperand" Register="0" Operand="1" Destination="1"/>

		<cpu:ImmediateOffsetMemory AddressRegister="1" Register="0" ReadFromMemory="true"/>

		<cpu:BranchToRelative ref="ScreenRenderer.DrawImage" SetReturnAddress="true"/>

		<cpu:ImmediateData Operation="CopyOperand" Operand="0" Destination="1"/>
		<cpu:ImmediateData Operation="CopyOperand" Operand="0" Destination="1"/>
		<cpu:ImmediateData Operation="CopyOperand" Operand="0" Destination="1"/>
		<cpu:ImmediateData Operation="CopyOperand" Operand="0" Destination="1"/>

		<!--Restore Return Address-->
		<cpu:BlockMemory Registers="0100000000000000" ReadFromMemory="true" AddressRegister="13" UpdateAddressRegister="true" AddOffset="true" ApplyOffsetBeforeTransfer="false"/>

		<cpu:ImmediateData Operation="AddRegisterAndOperand" Register="14" Operand="0" Destination="15"/>
		
		<!--R2 = [R1] (Width)-->
		<cpu:ImmediateOffsetMemory AddressRegister="1" Register="2" ReadFromMemory="true"/>
		
		<!--R1 = R1 + 4-->
		<cpu:ImmediateData Operation="AddRegisterAndOperand" Register="1" Operand="4" Destination="1"/>
		
		<!--R3 = [R1] (Height)-->
		<cpu:ImmediateOffsetMemory AddressRegister="1" Register="3" ReadFromMemory="true"/>

		<!--R1 = R1 + 4-->
		<cpu:ImmediateData Operation="AddRegisterAndOperand" Register="1" Operand="4" Destination="1"/>

		<!--R4 = Screen.FrameBuffer-->
		<cpu:ImmediateData Operation="CopyOperand" Operand="0" Destination="4"/>

		<addressOf ref="Screen.FrameBuffer" type="Absolute8"/>
		<cpu:Immediate8 Operation="OrRegisterWithOperand" Register="4" Rotate="0" Destination="4"/>

		<addressOf ref="Screen.FrameBuffer" type="Absolute16High8"/>
		<cpu:Immediate8 Operation="OrRegisterWithOperand" Register="4" Rotate="12" Destination="4"/>

		<addressOf ref="Screen.FrameBuffer" type="Absolute24High8"/>
		<cpu:Immediate8 Operation="OrRegisterWithOperand" Register="4" Rotate="8" Destination="4"/>

		<addressOf ref="Screen.FrameBuffer" type="Absolute32High8"/>
		<cpu:Immediate8 Operation="OrRegisterWithOperand" Register="4" Rotate="4" Destination="4"/>

		<cpu:ImmediateOffsetMemory AddressRegister="4" Register="4" ReadFromMemory="true"/>

		<!--R5 = Screen.Stride-->
		<cpu:ImmediateData Operation="CopyOperand" Operand="0" Destination="5"/>

		<addressOf ref="Screen.Stride" type="Absolute8"/>
		<cpu:Immediate8 Operation="OrRegisterWithOperand" Register="5" Rotate="0" Destination="5"/>

		<addressOf ref="Screen.Stride" type="Absolute16High8"/>
		<cpu:Immediate8 Operation="OrRegisterWithOperand" Register="5" Rotate="12" Destination="5"/>

		<addressOf ref="Screen.Stride" type="Absolute24High8"/>
		<cpu:Immediate8 Operation="OrRegisterWithOperand" Register="5" Rotate="8" Destination="5"/>

		<addressOf ref="Screen.Stride" type="Absolute32High8"/>
		<cpu:Immediate8 Operation="OrRegisterWithOperand" Register="5" Rotate="4" Destination="5"/>

		<cpu:ImmediateOffsetMemory AddressRegister="5" Register="5" ReadFromMemory="true"/>

		<!--While(R3 != 0)-->
		<label id="loopY"/>

		<!--R6 = R2-->
		<cpu:ImmediateData Operation="AddRegisterAndOperand" Register="2" Operand="0" Destination="6"/>
		
		<!--R7 = R4-->
		<cpu:ImmediateData Operation="AddRegisterAndOperand" Register="4" Operand="0" Destination="7"/>
		
		<!--While(R6 != 0)-->
		<label id="loopX"/>
		
		<!--R8 = [R1]-->
		<cpu:ImmediateOffsetMemory AddressRegister="1" Register="8" ReadFromMemory="true"/>
		
		<!--[R4] = R8-->
		<cpu:ImmediateOffsetMemory AddressRegister="4" Register="8" ReadFromMemory="false"/>

		<!--R1 = R1 + 4-->
		<cpu:ImmediateData Operation="AddRegisterAndOperand" Register="1" Operand="4" Destination="1"/>
		
		<!--R4 = R4 + 4-->
		<cpu:ImmediateData Operation="AddRegisterAndOperand" Register="4" Operand="4" Destination="4"/>

		<!--R6 = R6 - 1-->
		<cpu:ImmediateData Operation="SubtractOperandFromRegister" Register="6" Operand="1" Destination="6" SetFlags="true"/>

		<cpu:BranchToRelative ref="loopX" Condition="NotEqual"/>

		<!--R4 = R7 + R5-->
		<cpu:RegisterData Operation="AddRegisterAndOperand" Register="7" Operand="5" Destination="4"/>
		
		<!--R3 = R3 - 1-->
		<cpu:ImmediateData Operation="SubtractOperandFromRegister" Register="3" Operand="1" Destination="3" SetFlags="true"/>

		<cpu:BranchToRelative ref="loopY" Condition="NotEqual"/>

		<!--Restore Return Address-->
		<cpu:BlockMemory Registers="0100000000000000" ReadFromMemory="true" AddressRegister="13" UpdateAddressRegister="true" AddOffset="true" ApplyOffsetBeforeTransfer="false"/>
		
		<cpu:ImmediateData Operation="AddRegisterAndOperand" Register="14" Operand="0" Destination="15"/>
	</label>

	<label id="characterAddresses">
		<int>0</int>
		<int>0</int>
		<int>0</int>
		<int>0</int>
		<int>0</int>
		<int>0</int>
		<int>0</int>
		<int>0</int>
		<int>0</int>
		<int>0</int>

		<int>0</int>
		<int>0</int>
		<int>0</int>
		<int>0</int>
		<int>0</int>
		<int>0</int>
		<int>0</int>
		<int>0</int>
		<int>0</int>
		<int>0</int>

		<int>0</int>
		<int>0</int>
		<int>0</int>
		<int>0</int>
		<int>0</int>
		<int>0</int>
		<int>0</int>
		<int>0</int>
		<int>0</int>
		<int>0</int>

		<int>0</int>
		<int>0</int>
		<addressOf ref="Resources.Images.Input_32.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_33.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_34.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_35.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_36.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_37.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_38.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_39.bmp" type="Absolute32"/>
		
		<addressOf ref="Resources.Images.Input_40.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_41.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_42.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_43.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_44.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_45.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_46.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_47.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_48.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_49.bmp" type="Absolute32"/>
		
		<addressOf ref="Resources.Images.Input_50.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_51.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_52.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_53.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_54.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_55.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_56.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_57.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_58.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_59.bmp" type="Absolute32"/>
		
		<addressOf ref="Resources.Images.Input_60.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_61.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_62.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_63.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_64.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_65.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_66.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_67.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_68.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_69.bmp" type="Absolute32"/>
		
		<addressOf ref="Resources.Images.Input_70.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_71.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_72.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_73.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_74.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_75.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_76.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_77.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_78.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_79.bmp" type="Absolute32"/>
		
		<addressOf ref="Resources.Images.Input_80.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_81.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_82.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_83.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_84.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_85.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_86.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_87.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_88.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_89.bmp" type="Absolute32"/>
		
		<addressOf ref="Resources.Images.Input_90.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_91.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_92.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_93.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_94.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_95.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_96.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_97.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_98.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_99.bmp" type="Absolute32"/>
		
		<addressOf ref="Resources.Images.Input_100.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_101.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_102.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_103.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_104.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_105.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_106.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_107.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_108.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_109.bmp" type="Absolute32"/>
		
		<addressOf ref="Resources.Images.Input_110.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_111.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_112.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_113.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_114.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_115.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_116.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_117.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_118.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_119.bmp" type="Absolute32"/>
		
		<addressOf ref="Resources.Images.Input_120.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_121.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_122.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_123.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_124.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_125.bmp" type="Absolute32"/>
		<addressOf ref="Resources.Images.Input_126.bmp" type="Absolute32"/>
		<int>0</int>
	</label>
</scope>